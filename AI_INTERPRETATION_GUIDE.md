# AI解读功能使用指南

## 功能概述

AI解读功能是本系统的智能增强特性，通过调用大语言模型（如GPT）对传统命理分析结果进行深度解读和现代化阐释，为用户提供更加通俗易懂、贴近现代生活的指导建议。

## 主要特性

### 🧠 智能解读
- 对八字、紫微斗数、易经占卜结果进行AI深度分析
- 将古典命理术语转换为现代语言
- 提供实用的人生指导和建议

### ⚙️ 灵活配置
- 支持多种AI服务提供商（OpenAI、Azure OpenAI等）
- 可自定义模型参数（温度、最大Token数等）
- 支持自定义提示词模板

### 💾 结果缓存
- 自动保存AI解读结果到本地存储
- 避免重复调用，节省API费用
- 支持重新解读功能

## 使用方法

### 1. 配置AI服务

#### 方法一：环境变量配置（推荐）
在项目根目录的 `.env` 文件中添加以下配置：

```env
# AI API密钥
VITE_AI_API_KEY=your-openai-api-key-here

# AI API服务地址
VITE_AI_API_URL=https://api.openai.com/v1/chat/completions

# AI模型名称
VITE_AI_MODEL_NAME=gpt-3.5-turbo

# AI请求最大Token数
VITE_AI_MAX_TOKENS=2000

# AI温度参数（0-2，控制回答的创造性）
VITE_AI_TEMPERATURE=0.7

# AI请求超时时间（毫秒）
VITE_AI_TIMEOUT=30000
```

#### 方法二：界面配置
1. 在分析结果页面点击「AI解读」按钮
2. 如果未配置，系统会提示配置AI设置
3. 点击「配置」按钮打开配置界面
4. 填写API Key、API地址等信息
5. 点击「测试连接」验证配置
6. 保存配置

### 2. 使用AI解读

#### 在分析结果页面
1. 完成命理分析后，在结果页面找到「AI智能解读」区域
2. 点击「AI解读」按钮
3. 等待AI分析完成
4. 查看AI解读结果

#### 在历史记录页面
1. 进入历史记录页面
2. 在记录列表中点击「AI解读」按钮，或
3. 点击「查看」进入详情页，然后使用AI解读功能

### 3. 管理解读结果

- **查看解读**：点击「查看AI解读」展开/收起解读内容
- **重新解读**：点击「重新解读」按钮获取新的AI分析
- **配置管理**：点击「配置」按钮修改AI设置

## 支持的AI服务商

### OpenAI
- **API地址**：`https://api.openai.com/v1/chat/completions`
- **推荐模型**：`gpt-3.5-turbo`、`gpt-4`
- **获取API Key**：访问 [OpenAI官网](https://platform.openai.com/api-keys)

### Azure OpenAI
- **API地址**：`https://your-resource.openai.azure.com/openai/deployments/your-deployment/chat/completions?api-version=2023-12-01-preview`
- **认证方式**：需要在请求头中使用 `api-key` 而不是 `Authorization`

### 其他兼容服务
任何兼容OpenAI Chat Completions API格式的服务都可以使用，包括：
- Anthropic Claude（通过代理）
- 本地部署的开源模型
- 其他云服务商的API

## 提示词模板

系统为不同的分析类型预设了专业的提示词模板：

### 八字分析提示词
```
你是一位专业的八字命理大师，请对以下八字分析结果进行深度解读和补充说明。

请从以下几个方面进行解读：
1. 命格特点的深层含义
2. 五行平衡对人生的具体影响
3. 大运流年的关键转折点
4. 实用的人生建议和注意事项
5. 现代生活中的应用指导

请用通俗易懂的语言，结合现代生活实际，给出具有指导意义的解读。
```

### 紫微斗数提示词
```
你是一位资深的紫微斗数专家，请对以下紫微斗数分析结果进行专业解读。

请重点分析：
1. 命宫主星的性格特质解析
2. 十二宫位的相互影响
3. 大限小限的运势变化
4. 桃花、财帛、事业等重点宫位分析
5. 现实生活中的应用建议

请结合现代社会背景，提供实用的人生指导。
```

### 易经占卜提示词
```
你是一位精通易经的占卜大师，请对以下易经占卜结果进行深入解读。

请从以下角度分析：
1. 卦象的深层寓意
2. 爻辞的具体指导意义
3. 变卦的发展趋势
4. 针对问题的具体建议
5. 行动时机和注意事项

请用现代语言解释古典智慧，提供切实可行的指导。
```

## 费用说明

- AI解读功能需要调用第三方AI服务，会产生API费用
- 费用由您的AI服务商账户承担
- 建议合理设置Token限制以控制费用
- 系统会缓存解读结果，避免重复调用

## 常见问题

### Q: 为什么AI解读按钮是灰色的？
A: 这表示AI配置不完整，请检查API Key、API地址等配置是否正确。

### Q: AI解读失败怎么办？
A: 请检查：
1. 网络连接是否正常
2. API Key是否有效
3. API地址是否正确
4. 账户余额是否充足

### Q: 可以使用免费的AI服务吗？
A: 可以使用任何兼容OpenAI API格式的服务，包括一些提供免费额度的服务。

### Q: AI解读结果不满意怎么办？
A: 可以：
1. 点击「重新解读」获取新的分析
2. 调整温度参数改变AI的创造性
3. 修改提示词模板以获得更符合需求的解读

### Q: 解读结果会保存吗？
A: 是的，解读结果会自动保存到浏览器本地存储中，下次查看同一分析时会直接显示已保存的解读。

## 技术实现

### 架构设计
- **配置管理**：`src/config/aiConfig.ts`
- **服务层**：`src/services/aiInterpretationService.ts`
- **UI组件**：`src/components/ui/AIInterpretationButton.tsx`
- **配置界面**：`src/components/ui/AIConfigModal.tsx`

### 数据流程
1. 用户触发AI解读
2. 系统检查配置有效性
3. 将分析结果转换为Markdown格式
4. 使用提示词模板构建请求
5. 调用AI API获取解读
6. 显示结果并保存到本地存储

### 安全考虑
- API Key等敏感信息存储在本地
- 支持环境变量配置避免硬编码
- 请求超时保护
- 错误处理和用户友好提示

## 更新日志

### v1.0.0
- 初始版本发布
- 支持八字、紫微斗数、易经三种分析类型的AI解读
- 提供完整的配置界面和结果管理功能
- 集成到分析结果页面和历史记录页面

---

如有其他问题或建议，请联系开发团队。